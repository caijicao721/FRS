<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta charset="utf-8">
  <!--字体图标-->
  <link href="../../javaex/pc/css/icomoon.css" rel="stylesheet" />
  <!--动画-->
  <link href="../../javaex/pc/css/animate.css" rel="stylesheet" />
  <!--骨架样式-->
  <link href="../../javaex/pc/css/common.css" rel="stylesheet" />
  <!--皮肤（缇娜）-->
  <link href="../../javaex/pc/css/skin/tina.css" rel="stylesheet" />
  <!--jquery，不可修改版本-->
  <script src="../../javaex/pc/lib/jquery-1.7.2.min.js"></script>
  <!--全局动态修改-->
  <script src="../../javaex/pc/js/common.js"></script>
  <!--核心组件-->
  <script src="../../javaex/pc/js/javaex.min.js"></script>
  <!--表单验证-->
  <script src="../../javaex/pc/js/javaex-formVerify.js"></script>
  <title>后台管理</title>
</head>
<style>

</style>

<body>
<!--全部主体内容-->
<div class="list-content">
  <!--块元素-->
  <div class="block">
    <!--修饰块元素名称-->
    <div class="banner">
      <p class="tab fixed">编辑报销申请</p>
    </div>

    <!--正文内容-->
    <div class="main">
      <form>
        <!--文本框-->
        <div class="unit clear">
          <div class="left"><span class="required">*</span><p class="subtitle">姓名</p></div>
          <div class="right">
            <input type="text" id="name" class="text" placeholder="请输入姓名" />
          </div>
        </div>

        <div class="unit clear">
          <div class="left"><span class="required">*</span><p class="subtitle">VAT</p></div>
          <div class="right">
            <input type="text" id="vat" class="text" placeholder="请输入增值税号" />
          </div>
        </div>

        <div class="unit clear">
          <div class="left"><span class="required">*</span><p class="subtitle">报销金额</p></div>
          <div class="right">
            <input type="text" id="money" class="text" placeholder="请输入报销金额" />
          </div>
        </div>

        <!--下拉选择框-->
        <div class="unit clear">
          <div class="left"><p class="subtitle">是否有发票</p></div>
          <div class="right">
            <select id="select">
              <option value="">请选择</option>
              <option value="1">是</option>
              <option value="0">否</option>
            </select>
          </div>
        </div>

        <div class="unit clear">
          <div class="left"><span class="required"></span><p class="subtitle">分类</p></div>
          <div class="right">
            <input type="text" id="type" class="text" placeholder="报销分类" />
          </div>
        </div>

        <div class="unit clear">
          <div class="left"><span class="required"></span><p class="subtitle">抬头</p></div>
          <div class="right">
            <input type="text" id="title" class="text" placeholder="发票抬头" />
          </div>
        </div>

        <div class="unit clear">
          <div class="left"><p class="subtitle">发票日期</p></div>
          <div class="right">
            <input type="text" id="billDate" class="ex-date" style="width: 350px;" value="" readonly/>
          </div>
        </div>

        <!--提交按钮-->
        <div class="unit clear" style="width: 800px;">
          <div style="text-align: center;">
            <!--表单提交时，必须是input元素，并指定type类型为button，否则ajax提交时，会返回error回调函数-->
            <input type="button" id="return" class="button no" value="返回" />
            <input type="button" id="save" class="button yes" value="保存" />
          </div>
        </div>
      </form>

    </div>
  </div>
</div>

<script type="text/javascript">

  // 页面一加载赋值表单
  $(document).ready(function(){
    // 地址栏参数
    var id = getQueryVariable("id");
    // get读取参数
    $.get("/invoice/detail",{"id": id}, function(data){
      console.log(data);
      // 页面一加载, 读取登录用户信息
      $("#name").val(data.name);
      $("#type").val(data.type);
      $("#money").val(data.money);
      $("#billDate").val(data.billDate);
      $("#vat").val(data.vat);
      $("#title").val(data.title);
      if (data.hasBill==1) $('#select').val(1);// 类目
      else $('#select').val(0);
    });

  });

  javaex.date({
    id : "billDate",	// 承载日期组件的id
    isTime : true,
    date : "2020-04-15 01:01:01",	// 选择的日期
    // 重新选择日期之后返回一个时间对象
    callback : function(rtn) {
    }
  });

  // 获取地址栏参数
  function getQueryVariable(variable){
    var query = window.location.search.substring(1);
    var vars = query.split("&");
    for (var i=0;i<vars.length;i++) {
      var pair = vars[i].split("=");
      if(pair[0] == variable){return pair[1];}
    }
    return false;
  }

  // 监听点击保存按钮事件
  $("#save").click(function() {
    // 获取输入内容
    var name = $("#name").val();
    var vat = $("#vat").val();
    var type = $("#type").val();
    var hasBill = $('#select option:selected').val();// 类目
    var money = $("#money").val();
    var billDate = $("#billDate").val();
    var title = $("#title").val();
    console.log($("#billDate").val());
    // 校验文本
    if (name == "") {
      javaex.optTip({
        content : "姓名不能为空!",
        type : "error"
      });

      return false;
    }

    if (vat == "") {
      javaex.optTip({
        content : "vat不能为空!",
        type : "error"
      });

      return false;
    }

    if (money == "") {
      javaex.optTip({
        content : "报销金额不能为空!",
        type : "error"
      });

      return false;
    }

    if (hasBill == "") {
      javaex.optTip({
        content : "请选择是否有发票!",
        type : "error"
      });

      return false;
    }

    var id = getQueryVariable("id");
    // 表单数据
    var json = {"id":id,"name":name,"type":type,"money":money,"hasBill":hasBill,"billDate":billDate,"vat":vat,"title":title};

    // 提交
    // ajax 示例
    $.ajax({
      //请求方式
      type : "POST",
      //请求的媒体类型
      contentType: "application/json;charset=UTF-8",
      //请求地址
      url : "/invoice/update",
      //数据，json字符串
      data : JSON.stringify(json),
      //请求成功
      success : function(result) {
        console.log(result);
        // 获取集合属性
        if (result != 200) {
            javaex.message({
              content : "修改失败",
              type : "error"
            });
          }else {
            javaex.message({
              content : "修改成功",
              type : "success"
            });
            // 修改成功, 跳转页面
            setTimeout(function(){window.location.href="/invoice/invoice-currlist";},1500)
          }

          // 跳转至列表
//                    window.location.href="/book/book-list";
      },
      //请求失败，包含具体的错误信息
      error : function(e){
        console.log(e.status);
        console.log(e.responseText);
      }
    });

  });

  // 监听点击返回按钮事件
  $("#return").click(function() {
    window.location.href = "/invoice/invoice-currlist";
  });
</script>
</body>
</html>